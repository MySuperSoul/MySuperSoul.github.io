<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[python-basic]]></title>
    <url>%2F2019%2F06%2F23%2Fpython-basic%2F</url>
    <content type="text"><![CDATA[&nbsp;&nbsp;&nbsp;&nbsp;æœ€è¿‘é©¬ä¸Šè¦pythonè€ƒè¯•äº†ï¼Œanywayè™½ç„¶æ˜¯åŸºç¡€è¯¾ï¼Œè¿˜æ˜¯ç¨å¾®å¤ä¹ ä¸€ä¸‹ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å¯èƒ½ä¼šæœ‰çš„å‘å’Œå¹³æ—¶ä½œä¸šé‡Œé¢çš„ä¸€äº›é”™é¢˜ï¼Œä»¥åŽä¾ä¸€äº›å…¶ä»–åŸºæœ¬çš„éœ€è¦æ³¨æ„çš„ä¸œè¥¿éƒ½å¯ä»¥å†™åˆ°é‡Œé¢æ¥ï½ž Slideschapter1 Unicodeç ï¼šä¸ºæ¯ä¸ªå­—ç¬¦è®¾å®šäº†ç»Ÿä¸€çš„å¹¶ä¸”æ˜¯å”¯ä¸€çš„äºŒè¿›åˆ¶ç¼–ç ï¼Œç”¨æ¥æ»¡è¶³è·¨å¹³å°çš„éœ€æ±‚ã€‚ \uè¡¨ç¤ºUnicodeç ã€‚ utf-8ç¼–ç ï¼šæ¯ä¸€ä¸ªASCIIç éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„utf-8ç¼–ç ï¼Œæ­£å¥½ä¸Ž8ä½çš„ASCIIç¼–ç æ˜¯ä¸€æ ·çš„ã€‚pyç¨‹åºé»˜è®¤æ˜¯utf-8ç¼–ç æ ¼å¼ï¼Œå¹¶ä¸”æ˜¯ä¸å®šé•¿çš„ç¼–ç æ–¹å¼ã€‚ pyæ˜¯ä¸€ç§è§£é‡Šåž‹çš„è¯­è¨€ã€‚ æ ‡è¯†ç¬¦ï¼šç”±å­—ç¬¦ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ç»„æˆï¼Œä½†æ˜¯æ³¨æ„çš„æ˜¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´. my_test _123 chapter2 äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ï¼š0b(B)ã€0o(O)ã€0x(X) æµ®ç‚¹æ•°è¿ç®—å­˜åœ¨è¯¯å·®ï¼š2.1-2.0==0.1 False. å¹¶ä¸”æµ®ç‚¹æ•°çš„//è¿ç®—è¾“å‡ºä¹Ÿæ˜¯æµ®ç‚¹æ•°ã€‚ å¤æ•°ï¼šreal+imag * jï¼Œå…¶ä¸­realæ˜¯å®žæ•°éƒ¨åˆ†ï¼Œimagæ˜¯è™šæ•°éƒ¨åˆ†ã€‚ å‡½æ•°å’Œæ–¹æ³•ï¼šæ–¹æ³•æ˜¯ä¾èµ–æ•°æ®ç±»åž‹çš„å¦ä¸€ç§æ–¹æ³•ã€‚ å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæ˜¯ç”¨&#39;&#39;&#39;xxx&#39;&#39;&#39;æ¥è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸²ã€‚ pythonæ”¯æŒå¤šæ¡ä»¶æ¯”è¾ƒï¼Œä¹Ÿå³1&lt;3&lt;5 == 1&lt;3 and 3&lt;5, 1&lt;3&gt;2 == 1&lt;3 and 3&gt;2, æ‰€ä»¥è¿™ä¸¤ä¸ªéƒ½æ˜¯True 3 and 5, æœ€åŽä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ è¿ç®—çš„ä¼˜å…ˆçº§å’Œæ–¹å‘ï¼šé™¤æŽ‰**çš„æ–¹å‘æ˜¯ä»Žå³å¾€å·¦çš„ï¼Œå…¶ä»–æ‰€æœ‰è¿ç®—çš„æ–¹å‘éƒ½æ˜¯ä»Žå·¦å¾€å³çš„ã€‚ åˆ—è¡¨è¿ç®—ï¼šåŠ æ³•[1, 2, 3] + [c, py], ä¹˜æ³•[1] * 3 -&gt; [1, 1, 1] intå‡½æ•°ç”¨æ³•ï¼šint()-&gt;0, int(&quot;02&quot;), int(&quot; 35 &quot;), int(&quot;35&quot;, 8) åºåˆ—ä¸ç­‰çš„èµ‹å€¼ï¼ši, *j = &quot;123&quot;, j -&gt; [&#39;2&#39;, &#39;3&#39;] æ ¼å¼åŒ–ï¼š^, &lt;, &gt;åˆ†åˆ«ä»£è¡¨çš„æ˜¯å±…ä¸­ã€å·¦ã€å³å¯¹é½æ–¹å¼ã€‚ç§‘å­¦è®¡æ•°æ³•ï¼š.2eä¿ç•™ä¸¤ä½å°æ•°çš„ç§‘å­¦è®¡æ•°æ³•ã€‚{index_1:x.yf}{index_2:x.yf}æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚ chapter3 åˆ—è¡¨é€†åºï¼šlst[::-1]ã€‚ åˆ—è¡¨çš„æµ…å¤åˆ¶ï¼šb = a[:], è¿™æ ·å¤åˆ¶å‡ºæ¥çš„å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„åˆ—è¡¨ã€‚ åŽŸå§‹å­—ç¬¦ä¸²ï¼šr&#39;hello\n&#39; -&gt; hello\n, å­—ç¬¦ä¸²ä¸å¯ä¿®æ”¹, find(str, start_pos, end_pos) å­—ç¬¦ä¸²çš„formatå‡½æ•°ï¼š{index:&lt;å¡«å……&gt;|^, &gt;, &lt;| &lt;å®½åº¦.ç²¾åº¦&gt;&lt;æ ¼å¼&gt;} åˆ—è¡¨æ–¹æ³•ï¼šl.extend(x), l.pop(index)é»˜è®¤æœ€åŽä¸€ä¸ªä¸”ä¼šè¿”å›ž, l.remove(value), l.reverse(), l.sort(), l.insert(index, value)è‹¥indexè¶…åˆ™æœ€åŽä¸€ä¸ª. éœ€è¦æ³¨æ„splitå‡½æ•°ï¼š 123456sen = 'hello wor ld 's = sen.split()print(len(s)) -&gt; 3s = sen.split(' ')print(len(s)) -&gt; 10 éšæœºå‡½æ•°åº“ï¼šrandomåº“ random.random() -&gt; [0.0, 1.0) random.uniform(a, b) -&gt; [a, b] random.randint(a, b) -&gt; éšæœºçš„ä¸€ä¸ªæ•´æ•° chapter4 Python mapå‡½æ•°: map(function, iterable) å¯¹æŒ‡å®šçš„åºåˆ—æ‰§è¡Œmapæ“ä½œï¼Œä¹Ÿå³æ¯ä¸ªå…ƒç´ éƒ½æ‰§è¡Œfunction, x, y = map(int, input().split())æ‰§è¡Œçš„æ˜¯å†…ç½®å‡½æ•°int, æˆ–è€…ä¹Ÿå¯ä»¥æ˜¯åŒ¿åå‡½æ•°map(lambda x : x**2, [1, 2, 3]). try-exceptä½¿ç”¨æ ¼å¼ï¼š 1234567891011try: blockexcept Exception 1: block1except Exception 2: block2except: block3else: block4finally: block5 chapter5 setæ˜¯ä¸€ç§å®¹å™¨ï¼Œæ²¡æœ‰å…ˆåŽé¡ºåºï¼Œå¹¶ä¸”å…ƒç´ çš„å€¼ä¸é‡å¤, éœ€è¦æ³¨æ„çš„æ˜¯é›†åˆçš„å…ƒç´ éœ€è¦æ˜¯ä¸å¯å˜å¯¹è±¡, æ¢å¥è¯è¯´å°±æ˜¯åˆ—è¡¨ä¸èƒ½æˆä¸ºé›†åˆå½“ä¸­çš„å…ƒç´ . ç©ºé›†åˆï¼š 12empty = set()empty = &#123;&#125; #åˆ›å»ºçš„æ˜¯ç©ºå­—å…¸ æ–¹æ³•ï¼šadd, remove, len, max, min, sum, issubset, issuperset, éœ€è¦ç‰¢è®°çš„æ˜¯é›†åˆæ˜¯æ— åºçš„ï¼Œæ‰€ä»¥æ¯æ¬¡printå‡ºæ¥çš„ç»“æžœæ˜¯ä¸ç¡®å®šçš„ã€‚ åœ¨é›†åˆå½“ä¸­çš„ == åˆ¤æ–­çš„æ˜¯ä¸¤ä¸ªsetå½“ä¸­çš„å…ƒç´ æ˜¯å¦æ˜¯ç›¸åŒçš„ï¼Œå¦‚æžœæ˜¯ç›¸åŒçš„åˆ™è¾“å‡ºçš„æ˜¯True. &lt;, &lt;=, &gt;, &gt;=åˆ¤æ–­æ˜¯å­é›†ï¼ŒçœŸå­é›†ï¼Œè¶…é›†ï¼ŒçœŸè¶…é›†è¿™äº›çš„ã€‚ é›†åˆè¿ç®—|, &amp;, -, ^åˆ†åˆ«æ˜¯å¹¶é›†ã€äº¤é›†ã€å·®é›†ã€å¯¹ç§°å·®ï¼Œå¯¹ç§°å·®æŒ‡çš„æ˜¯é™¤äº†å…±åŒå…ƒç´ ä¹‹å¤–çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯a ^ b = (a | b) - (a &amp; b) åˆ—è¡¨åŽ»é‡å¹¶ä¸”é¡ºåºä¸å˜ä¸¤ç§æ–¹æ³•ï¼š 123456789a = [1, 2, 6, 1, 3, 4, 2, 5]addr_to = list(set(a))addr_to.sort(key=a.index)a = [1, 2, 6, 1, 3, 4, 2, 5]addr_to = []for i in a: if not i in addr_to: addr_to.append(i) å­—å…¸çš„åˆ›å»ºæ–¹å¼ï¼š 123fac = dict([(key1, value1), (key2, value2)])fac = dict(key1=value1, key2=value2) #è¿™ç§æ–¹å¼éœ€è¦ä½¿ç”¨æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”é”®ç”¨çš„æ˜¯strç±»åž‹# -&gt; &#123;'key1':value1, 'key2':value2&#125; å­—å…¸çš„é”®å¿…é¡»è¦æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå¯å˜å¯¹è±¡æ¯”å¦‚åˆ—è¡¨ï¼Œå­—å…¸æ˜¯ä¸èƒ½ä½œä¸ºå­—å…¸çš„é”®çš„ã€‚ å­—å…¸çš„æ–¹æ³•ï¼šin, not inåˆ¤æ–­çš„æ˜¯ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨å­—å…¸çš„é”®å½“ä¸­ã€‚get(key, é»˜è®¤å€¼)è¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨åŽé¢è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ä½œä¸ºä¸å­˜åœ¨æ—¶å€™çš„è¿”å›žï¼Œä¸åŠ æ˜¯None. chapter6 lambdaè¡¨è¾¾å¼ï¼šg = lambda x, y, z : x + y + z -&gt; g(1, 2, 3) ä½ç½®å‚æ•°: å°±æ˜¯æ™®é€šçš„é‚£ç§å‚æ•°ä¼ é€’æ–¹å¼ å…³é”®å­—å‚æ•°ï¼š 12345def dis(x1,y1,x2,y2): #æ±‚å¹³é¢ä¸Šä¸¤ç‚¹è·ç¦» print("x1=&#123;&#125;,y1=&#123;&#125;,x2=&#123;&#125;,y2=&#123;&#125;".format(x1,y1,x2,y2)) return sqrt((x1-x2)**2+(y1-y2)**2)print(dis(x1=1,y2=5,y1=3,x2=4)) ä½ç½®å‚æ•°ä¸Žå…³é”®å­—å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼šéœ€è¦æ³¨æ„âš ï¸çš„æ˜¯è¿™ç§æƒ…å†µä¹‹ä¸‹ï¼Œä½ç½®å‚æ•°éœ€è¦å…ˆå†™ï¼Œç„¶åŽå†ä½¿ç”¨å…³é”®å­—å‚æ•°ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚ 12345678910111213#correct usefrom math import sqrtdef dis(x1,y1,x2,y2): #æ±‚å¹³ é¢ä¸Šä¸¤ç‚¹è·ç¦» print("x1=&#123;&#125;,y1=&#123;&#125;,x2=&#123;&#125;,y2=&#123;&#125;".format(x1,y1,x2,y2)) return sqrt((x1-x2)**2+(y1-y2)**2)print(dis(1,3,y2=5,x2=4))#wrong casefrom math import sqrtdef dis(x1,y1,x2,y2): #æ±‚å¹³é¢ä¸Šä¸¤ç‚¹è·ç¦» print("x1=&#123;&#125;,y1=&#123;&#125;,x2=&#123;&#125;,y2=&#123;&#125;".format(x1,y1,x2,y2)) return sqrt((x1-x2)**2+(y1-y2)**2)print(dis(1,y1=3,4,5)) é»˜è®¤å€¼å‚æ•°ï¼šè¿™é‡Œå°±æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤å€¼å‚æ•°åœ¨å‡½æ•°å¯¹è±¡è¢«åˆ›å»ºçš„æ—¶å€™åŒæ—¶è¢«åˆ›å»ºï¼Œç›¸å½“äºŽå¦‚æžœé»˜è®¤å€¼æœ‰ä¸€ä¸ªlistçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªé™æ€çš„staticçš„listä¸€ç›´å­˜åœ¨ï¼š 12345def init(arg, result=[]): result.append(arg)print(result)init('a') #['a']init('b') #['a', 'b'] ä¸å®šé•¿æ•°ç›®å‚æ•°ï¼šä½¿ç”¨*å°†å¯å˜çš„å‚æ•°å˜ä¸ºå…ƒç»„å­˜æ”¾ï¼Œå…·ä½“çš„ä½¿ç”¨ðŸŒ°ï¼š 12345def countnum(a,*b): #è®¡ç®—å‚æ•°ä¸ªæ•° print(b) #(7, 9) print(len(b)+1) # 3countnum(3,7,9)countnum(5,8,1,6,89) *æˆ–è€…æ˜¯**ä½œç”¨åœ¨å‡½æ•°çš„å½¢å‚ä¸Šä»£è¡¨çš„åˆ†åˆ«æ˜¯ç”¨å…ƒç»„å’Œå­—å…¸æ¥æŽ¥æ”¶å‚æ•°ã€‚*æˆ–è€…æ˜¯**ä½œç”¨åœ¨å®žå‚ä¸Šä»£è¡¨çš„æ˜¯è§£åŒ…ï¼š 1234567lst = [1, 2, 3]print(*lst) # 1 2 3def countnum(a,**d): #è®¡ç®—å‚æ•°ä¸ªæ•° print(d) print(len(d)+1)countnum(3,x1=9,x2=1,x3=6,x4=89) å‘½åç©ºé—´ï¼šå…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ä¸ä¸€æ ·ï¼Œåœ¨å±€éƒ¨åŒºåŸŸé‡Œé¢å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ä¸èƒ½åœ¨å±€éƒ¨å‡½æ•°å†…éƒ¨å†å®šä¹‰åŒåå˜é‡ï¼Œå¦åˆ™å‡ºé”™âŒã€‚ä½†æ˜¯ä¸€æ—¦å®šä¹‰äº†åŒåçš„å˜é‡ï¼Œä½¿ç”¨éƒ½æ˜¯ç”¨çš„å±€éƒ¨å˜é‡æ¥ä½¿ç”¨ã€‚è¦ä½¿ç”¨å’Œä¿®æ”¹å…¨å±€å˜é‡ï¼Œè¯·ä½¿ç”¨globalå…³é”®å­—æ¥å®Œæˆã€‚ å†…ç½®å‡½æ•°zipç”¨æ¥æ‰“åŒ…ðŸ“¦ä¸¤ä¸ªå¯è¿­ä»£çš„åºåˆ— 123456789101112131415161718192021222324252627a = [1, 2, 3]b = [4, 5, 6]print(list(zip(a, b)))# å­—å…¸çš„é”®å€¼å¯¹äº’æ¢dic = &#123;1:1, 2:2, '1':500&#125;print(dict(zip(dic.values(), dic.keys())))# &#123;1: 1, 2: 2, 500: '1'&#125;# eval è®¡ç®—è¡¨è¾¾å¼çš„å€¼a = 3; b = 7print(eval('a * 3 + b * 5'))# exec æ‰§è¡Œpythonè¯­å¥exec('print("hello world")')'''all, any æŽ¥å—çš„æ˜¯å¯è¿­ä»£çš„åºåˆ—allè¡¨ç¤ºå…¨éƒ¨æ˜¯Trueï¼Œæ‰è¿”å›žTrueanyè¡¨ç¤ºåªè¦æœ‰ä¸€ä¸ªTrueï¼Œå³ç»“æžœæœ€åŽè¿”å›žçš„æ˜¯True'''all([[], False, 0]) # Falseall([1, True, [1]]) # Trueany([[], False, 0]) # False# __main__çš„ä½œç”¨åŸŸå°±æ˜¯å…¨å±€åŸŸ å‘½ä»¤è¡Œå‚æ•°æ ¼å¼ï¼šsys.argv[0]æ–‡ä»¶åï¼Œsys.argv[1]â€¦éƒ½æ˜¯å‚æ•°ã€‚ chapter7 æ–‡ä»¶æ‰“å¼€ï¼šopen(filename, mode) è¯»å†™å‡½æ•°ï¼š read: å°†æ–‡ä»¶æ‰€æœ‰å†…å®¹è¯»å– readlines: æŒ‰è¡Œè¯»å–å†…å®¹ï¼Œä½†æ˜¯åˆ—è¡¨å½“ä¸­çš„æ¯ä¸€é¡¹æœ€åŽéƒ½æœ‰ä¸€ä¸ª\n, readlineä¹Ÿæ˜¯ä¸€æ ·çš„ä¼šæœ‰ä¸€ä¸ª\nåœ¨è¯»å–çš„å­—ç¬¦ä¸²æœ€åŽã€‚ å¤šæ¡ä»¶æŽ’åºï¼š 12ans=sorted(counts.items(), key=lambda x:(-x[1], x[0]))# æŒ‰ç…§valueé™åºï¼Œç„¶åŽå†æŒ‰ç…§keyå‡åºæŽ’åˆ— chapter8 ä¸€åˆ‡å†…å®¹çš†æ˜¯å¯¹è±¡ï¼Œå‡½æ•°å’Œç±»ä¹Ÿæ˜¯å¯¹è±¡ã€‚ ç±»ä¸»è¦æŒ‡çš„æ˜¯ç±»åž‹ï¼Œå¯¹è±¡æ˜¯æ¯”è¾ƒå…·ä½“çš„ä¸€äº›å€¼ã€‚lst = [1, 2, 3], å…¶ä¸­lstæ˜¯ç±»listçš„classï¼Œä¹Ÿå°±æ˜¯listç±»åž‹çš„å¯¹è±¡ ç±»æœ‰è‡ªå·±çš„åå­—ç©ºé—´ï¼ŒåŒæ—¶æ¯ä¸ªå¯¹è±¡ä¹Ÿæœ‰è‡ªå·±çš„åå­—ç©ºé—´ã€‚ æž„é€ æ–¹æ³•ï¼šdef __init__(self, â€¦) æž„é€ æ–¹æ³•ï¼Œå½“å¯¹è±¡è¢«æž„é€ çš„æ—¶å€™è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œå¯ä»¥å£°æ˜Žç±»æ‰€äº§ç”Ÿçš„å¯¹è±¡å±žæ€§ï¼Œå¹¶å¯ä¸ºå…¶èµ‹åˆå§‹å€¼ï¼Œæœ€é‡è¦çš„æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯ä¸èƒ½æœ‰è¿”å›žå€¼çš„ã€‚-&gt; åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è°ƒç”¨çš„æ˜¯objectæœ¬èº«çš„__init__æ–¹æ³•ã€‚ selfå‚æ•°ï¼šå¿…é¡»ä¸ºç¬¬ä¸€ä¸ªå½¢å‚ï¼Œä»£è¡¨çš„æ˜¯å°†æ¥è¦åˆ›å»ºçš„å¯¹è±¡æœ¬èº«ã€‚åœ¨ç±»çš„æ–¹æ³•å½“ä¸­è®¿é—®æ•°æ®æˆå‘˜çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨self.parameterè¿›è¡Œè°ƒç”¨ã€‚åœ¨å¤–éƒ¨é€šè¿‡å¯¹è±¡è°ƒç”¨å®žä¾‹æ–¹æ³•çš„æ—¶å€™ä¸éœ€è¦ä¼ é€’selfå‚æ•°ï¼Œå¦‚æžœåœ¨å¤–éƒ¨é€šè¿‡ç±»æ¥è°ƒç”¨å®žä¾‹æ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥æ˜¾å¼çš„æŠŠå¯¹è±¡ä¼ åˆ°selfé‡Œé¢ã€‚ pythonç¤¾å›¢è§„å®šï¼š _xxx å†…éƒ¨åï¼Œä¸åº”è¯¥åœ¨å¤–éƒ¨ä½¿ç”¨ __xxx pyè§£é‡Šå™¨ä¼šè‡ªåŠ¨æ¢åä¸º_class__xxxï¼Œæ‰€ä»¥å¯¹è±¡æ˜¯ç›´æŽ¥è®¿é—®ä¸åˆ°è¿™ä¸ªå˜é‡çš„.ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨object._class__xxxè®¿é—®åˆ°è¯¥å˜é‡ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯ç»å¯¹æ„ä¹‰ä¸Šçš„ç§æœ‰å˜é‡ã€‚ __xxx__ç³»ç»Ÿå®šä¹‰çš„ç‰¹æ®Šæˆå‘˜ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨è¿™ç§æ ‡è¯†ç¬¦ã€‚ ç±»å˜é‡å’Œå®žä¾‹å˜é‡éƒ½æ˜¯å¯ä»¥åŠ¨æ€å¢žåŠ å¯¹åº”çš„å˜é‡çš„. ç»§æ‰¿çš„ç±»å¦‚æžœé‡å†™äº†__init__, å¦‚æžœè¦åˆå§‹åŒ–çˆ¶ç±»éœ€è¦æ˜¾å¼çš„super().__init__è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–å‡½æ•°ã€‚ pythonå¤šæ€ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡é‡å†™__add__, __len__, __sub__ä¹‹ç±»çš„å‡½æ•°æ¥è‡ªå®šä¹‰è‡ªå·±çš„åŸºæœ¬è¿ç®—ã€‚]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>basis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Old Books Trading Website]]></title>
    <url>%2F2019%2F06%2F22%2FWebsite%2F</url>
    <content type="text"><![CDATA[&nbsp;&nbsp;&nbsp;&nbsp;é™†é™†ç»­ç»­å†™äº†å¤§æ¦‚ä¸¤å‘¨æ—¶é—´çš„æ—§ä¹¦äº¤æ˜“ç½‘ç«™ç»ˆäºŽå¿«å†™å®Œå•¦ï¼ï¼BSè¯¾ç¨‹çš„è¯¾ç¨‹é¡¹ç›®è®¾è®¡ï¼ŒçœŸæ˜¯å¿ƒåŠ›äº¤ç˜ã€‚åˆšå¥½æ–°æžäº†ä¸€ä¸ªåšå®¢è¯•è¯•æ°´ï¼Œå°±åœ¨è¿™é‡Œè®°å½•ä¸€äº›å¼€å‘è¿‡ç¨‹å½“ä¸­çš„æ„Ÿæƒ³å’Œç¢°åˆ°çš„å¾ˆå¤šå¾ˆå¤šå‘å§orzï¼Œä¸è¿‡è¿˜æ˜¯å­¦åˆ°å¾ˆå¤šä¸œè¥¿çš„å–ï¼ åŽç«¯æ¡†æž¶&nbsp;&nbsp;&nbsp;&nbsp;åŽç«¯æ¡†æž¶é€‰ç”¨çš„æ˜¯Djangoæ¡†æž¶å¼€å‘çš„ï¼Œä¸ºä»€ä¹ˆé€‰Pythonä½œä¸ºåŽç«¯çš„è¯­è¨€å‘¢ï¼Œä¸€æ–¹é¢æ˜¯è¿™å­¦æœŸåˆšå¥½ä¹Ÿæœ‰åœ¨ä¸Špythonè¯¾ç¨‹ï¼Œå¦ä¸€æ–¹é¢pythonçœŸçš„å¾ˆå‹å¥½å•Šï¼Œä¸è¿‡ä»¥åŽä¹Ÿè¦å°è¯•ç”¨java springåšç‚¹å°é¡¹ç›®ã€‚ Djangoè·¯ç”±&nbsp;&nbsp;&nbsp;&nbsp;Djangoæ¡†æž¶éµå¾ªçš„æ˜¯MVCçš„æ€æƒ³è¿›è¡Œå¼€å‘çš„æ¡†æž¶ã€‚urls.pyå½“ä¸­æ˜¯ç½‘ç«™è·¯ç”±çš„é…ç½®ï¼Œä¸€èˆ¬é¡¹ç›®çš„è·¯ç”±å½“ä¸­æ˜¯åˆ’å®šä¸åŒappä¸‹çš„èµ·å§‹è·¯ç”±ï¼Œç„¶åŽåœ¨ä¸åŒçš„appä¸‹å†å®šä¹‰å„è‡ªçš„urlï¼Œä½¿å¾—æ•´ä¸ªé¡¹ç›®çš„è·¯ç”±ç®¡ç†æ¯”è¾ƒç‹¬ç«‹ï¼Œæ¯”å¦‚åœ¨æˆ‘é¡¹ç›®å½“ä¸­çš„æ€»è·¯ç”±é…ç½®(BookTradeWeb/urls.py): 123456789urlpatterns = [ path('admin/', admin.site.urls), url(r'^password-reset/', include('password_reset.urls')), url(r'^auth/', include('useraction.urls')), url(r'^books/', include('books.urls')), url(r'^chatting/', include('chatting.urls')), url(r'^media/(?P&lt;path&gt;.*)$', serve, &#123;'document_root': settings.MEDIA_ROOT&#125;), url(r'^$', TemplateView.as_view(template_name="login.html")),] &nbsp;&nbsp;&nbsp;&nbsp;ç„¶åŽåœ¨æ¯ä¸ªå•ç‹¬çš„appé‡Œé¢å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„è·¯ç”±äº†ï¼Œä»¥æˆ‘å…¶ä¸­ä¸€ä¸ªapp(useraction)ä¸‹çš„urls.pyä¸ºðŸŒ°ï¼Œä¸è¿‡éœ€è¦è®°ä½çš„æ˜¯é€šè¿‡python manage.py startapp åˆ›å»ºä¹‹åŽçš„urls.pyæ˜¯éœ€è¦è‡ªå·±åˆ›å»ºçš„ã€‚åœ¨ä¸åŒçš„appé‡Œé¢å¯ä»¥å®šä¹‰è‡ªå·±çš„app_nameï¼Œåœ¨åŽé¢å†™æ¨¡æ¿è¯­è¨€çš„æ—¶å€™éžå¸¸çˆ½çš„ï¼ŒåŽé¢åœ¨å‰ç«¯é‚£é‡Œå†è¯¦ç»†å†™ï¼š 1234567app_name = 'useraction'urlpatterns = [ url(r'^login/$', views.UserLoginView.as_view(), name='login'), url(r'^register/$', views.UserRegisterView.as_view(), name='register'), url(r'^logout/$', views.UserLogoutView.as_view(), name='logout'),] Django Views&nbsp;&nbsp;&nbsp;&nbsp;Django viewså¯ä»¥è¯´æ˜¯å¾ˆå¼ºå¤§äº†ï¼Œåœ¨MVCæž¶æž„å½“ä¸­å®ƒå¯ä»¥å……å½“viewå’Œcontrollerä¸¤éƒ¨åˆ†çš„è§’è‰²ã€‚çŽ°åœ¨å¾ˆæµè¡Œä½¿ç”¨restfulçš„æ–¹å¼å¼€å‘ç½‘ç«™ã€‚ä¹Ÿå³åŽç«¯åªæä¾›æ•°æ®ï¼Œç”¨jsonæˆ–è€…protobufæˆ–è€…å…¶ä»–çš„æ•°æ®ç»„ç»‡å½¢å¼æ¥ä¼ è¾“æ•°æ®ï¼Œè€Œå‰ç«¯å‘åŽç«¯å‘é€è¯·æ±‚æ¥è¯·æ±‚æ•°æ®æˆ–è€…å¤„ç†é€»è¾‘ï¼Œå®žçŽ°å‰åŽç«¯åˆ†ç¦»çš„å¼€å‘ã€‚&nbsp;&nbsp;&nbsp;&nbsp;Django viewså› ä¸ºæœ‰å¾ˆå¤šDjangoè‡ªå·±çš„åŠ æŒï¼Œä½¿å¾—è¿™ä¸¤ç§æ¨¡å¼éƒ½æ”¯æŒï¼Œæ¯”å¦‚JsonResponseè¿”å›žjsonæ ¼å¼çš„æ•°æ®ï¼Œæˆ–è€…é€šè¿‡render(request, index.html, data)çš„æ–¹å¼ç›´æŽ¥è¿”å›žç½‘é¡µï¼Œå¹¶ä¸”èƒ½ç”¨éžå¸¸çˆ½çš„æ¨¡æ¿è¯­è¨€ï¼Œç®€ç›´äººè§äººçˆ±å•Šæœ‰æœ¨æœ‰ï¼&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯ç”¨çš„class-based viewçš„æ–¹å¼æ¥å†™views.pyçš„ï¼Œåœ¨BookTradeWeb/utils.pyå½“ä¸­å®šä¹‰äº†BaseViewï¼Œè¿™ä¸ªç±»ç»§æ‰¿äº†Djangoå½“ä¸­å†…ç½®çš„viewï¼ŒåŽé¢æˆ‘ä»¬è‡ªå·±çš„viewåªéœ€è¦ç»§æ‰¿BaseViewå³å¯ï¼Œæˆ‘ä»¬çœ‹çœ‹BaseViewé‡Œé¢å®šä¹‰äº†äº›å•¥ï¼š 123456789101112131415161718192021222324252627282930313233class BaseView(View): def dispatch(self, request, *args, **kwargs): self.request = request request.data = &#123;&#125; if request.method == 'GET': request.data = request.GET.dict() elif request.content_type == 'application/json': request.data = request.body.replace(b"'", b'"') request.data = json.loads(request.data) elif request.content_type == 'multipart/form-data': request.data = request.POST.dict() if not request.FILES == None: request.data['file'] = request.FILES['file'] elif request.content_type == 'application/x-www-form-urlencoded': request.data = request.POST.dict() return self.do_dispatch(request, *args, **kwargs) def do_dispatch(self, *args, **kwargs): handler = getattr(self, self.request.method.lower(), None) if not callable(handler): return JsonResponse(make_errors(f"http method &#123;self.request.method.lower()&#125; not allowed ")) else: try: data = handler(*args, **kwargs) if data == None: return JsonResponse(make_success('success')) elif self.request.method == 'GET' or not isinstance(data, dict): return data else: return JsonResponse(&#123;'data': data, 'code': 0&#125;) except Exception as e: traceback.print_exc() return JsonResponse(make_errors(str(e))) &nbsp;&nbsp;&nbsp;&nbsp;è¿™æ ·å®šä¹‰BaseViewæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Œé¦–å…ˆåœ¨BaseViewé‡Œé¢é‡å†™äº†Viewå½“ä¸­çš„dispatchæ–¹æ³•ï¼Œæ¯å½“æœ‰ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾å¯¹åº”è·¯ç”±é‚£é‡Œçš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨dispatchæ–¹æ³•ã€‚åœ¨dispatchå½“ä¸­æˆ‘ä»¬å°†æ•°æ®ç»Ÿä¸€éƒ½æ”¾åˆ°request.dataé‡Œé¢ï¼ŒåŽé¢çš„viewså½“ä¸­æ— è®ºæ˜¯POSTè¿˜æ˜¯GETéƒ½å¯ä»¥åœ¨request.dataé‡Œé¢æ‹¿åˆ°æ•°æ®ã€‚&nbsp;&nbsp;&nbsp;&nbsp;å…¶æ¬¡åœ¨do_dispatchå½“ä¸­ä¼šåŽ»è‡ªå®šä¹‰viewé‡Œé¢æ‰¾å¯¹åº”request methodçš„å¤„ç†æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„è‡ªå®šä¹‰viewé‡Œé¢åªéœ€è¦åŽ»å†™å¯¹åº”çš„å‡½æ•°ï¼Œæ¯”å¦‚è¯´def get(self, request) å¤„ç†getè¯·æ±‚ï¼Œdef post(self, request)æ¥å¤„ç†å¯¹åº”çš„postè¯·æ±‚ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿å‘¢ï¼åœ¨è‡ªå®šä¹‰viewå†™å®Œä¹‹åŽï¼Œåªéœ€è¦åœ¨urls.pyé‡Œé¢åŽ»æ³¨å†Œä¸€ä¸‹å°±å¥½äº†ï¼Œä¸‹é¢ä¸¾ä¸€ä¸ªðŸŒ°ï¼š 12345678910111213141516class UserLoginView(BaseView): def post(self, request): user = authenticate(username = request.data.get('username'), password = request.data.get('password')) if user and user.is_active: login(request, user) return user.to_dict() elif not user: raise Exception('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼') def get(self, request): return render(request, 'login.html')useraction/urls.pyurl(r'^login/$', views.UserLoginView.as_view(), name='login') Django models&nbsp;&nbsp;&nbsp;&nbsp;Djangoæä¾›äº†ä¸€å¥—éžå¸¸å®Œå¤‡çš„ORMï¼Œä»¥è‡³äºŽæˆ‘çœŸçš„ä¸€è¡ŒSQLè¯­å¥éƒ½æ²¡å†™å•ŠðŸ˜‚ã€‚modelsä¹Ÿå°±æ˜¯æ•°æ®åº“é‡Œé¢çš„è¡¨ï¼Œé€šè¿‡ç±»å®šä¹‰çš„æ–¹å¼æ¥å®šä¹‰æ¯ä¸€å¼ è¡¨å½“ä¸­çš„æ•°æ®é¡¹ã€å±žæ€§ã€å¤–é”®çº¦æŸç­‰ç­‰ã€‚ä¸€èˆ¬å®šä¹‰å¥½modelsä¹‹åŽåªéœ€è¦æ‰§è¡Œpython manage.py makemigrations &amp;&amp; python manage.py migrateå°†modelsè¿ç§»åˆ°æ•°æ®åº“å½“ä¸­ã€‚Djangoé¡¹ç›®åˆå§‹é»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“æ˜¯sqliteï¼Œæˆ‘è¿™é‡Œå°†å®ƒæ”¹æˆäº†MySQLï¼Œå…·ä½“å°±æ˜¯ä¿®æ”¹setting.pyé‡Œé¢çš„é…ç½®å°±å¥½äº†ã€‚&nbsp;&nbsp;&nbsp;&nbsp;ORMçš„è¯­æ³•ç½‘ä¸Šæ•™ç¨‹æˆ–è€…æ˜¯Djangoå®˜ç½‘æ•™ç¨‹éƒ½æœ‰å¾ˆå¤šçš„ã€‚ä¸»è¦å°±æ˜¯å†…éƒ¨ç”¨çš„ä¸€ä¸ªQuerySetç±»æ¥ä»£è¡¨è¿”å›žç»“æžœï¼Œè¿˜æœ‰å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„ç”¨æ³•è¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ Django setting&nbsp;&nbsp;&nbsp;&nbsp;Django é€šè¿‡åœ¨é¡¹ç›®ç›®å½•ä¸‹çš„setting.pyä¸‹é¢è¿›è¡Œæ•´ä¸ªé¡¹ç›®çš„é…ç½®ï¼Œå¤§æ¦‚è®²è§£ä¸€ä¸‹è¿™äº›é…ç½®æ˜¯å¹²å•¥çš„ï¼Œå°±è®²ä¸€äº›ä¸»è¦çš„ï¼Œå…¶ä»–çš„éƒ½æ˜¯å¾ˆå®¹æ˜“Googleåˆ°çš„ï¼š ALLOWED_HOSTS: å…è®¸é‚£äº›hostè®¿é—®ï¼Œå¦‚æžœéœ€è¦å…è®¸æ‰€æœ‰ä¸€èˆ¬è®¾ç½®ä¸º[â€˜*â€™, ] INSTALLED_APPS: è¿™ä¸ªé…ç½®æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥æ³¨å†Œé¡¹ç›®é‡Œé¢çš„appï¼Œå¦‚æžœä½ æ–°å»ºçš„appæ²¡æœ‰åœ¨è¿™é‡Œæ³¨å†Œçš„è¯ï¼Œé¡¹ç›®æ˜¯æ‰¾ä¸åˆ°ä½ çš„appé‡Œé¢çš„æ–¹æ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯æ¬¡æ–°å»ºéƒ½éœ€è¦åœ¨è¿™é‡Œè¿›è¡Œæ³¨å†Œä¹‹åŽæ‰èƒ½æ­£å¸¸çš„å·¥ä½œå“¦ðŸ˜¯ Middleware: è¿™é‡Œæ˜¯é¡¹ç›®ä¸­ä½¿ç”¨çš„ä¸­é—´ä»¶çš„é…ç½®ï¼Œæ¯”å¦‚Djangoå†…ç½®çš„ç”¨æˆ·è®¤è¯ä¸­é—´ä»·ï¼Œé˜²è·¨ç«™æ”»å‡»çš„csrftokenä¸­é—´ä»·ç­‰ç­‰ï¼Œå¦‚æžœä½¿ç”¨å…¶ä»–çš„å¼€æºä¸­é—´ä»·éƒ½éœ€è¦åœ¨è¿™é‡Œè¿›è¡Œæ³¨å†Œã€‚ TEMPLATES: è¿™é‡Œä¸»è¦æ˜¯å­˜æ”¾çš„é™æ€æ–‡ä»¶çš„æ„æ€ï¼ŒåŸºæœ¬ä¸ç”¨åŽ»æ”¹ï¼ŒDjangoä¼šåŽ»é¡¹ç›®æ‰€æœ‰çš„templatesæ–‡ä»¶å¤¹ä¸‹é¢æ‰¾å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶ã€‚ DATABASES: é¡¾åæ€ä¹‰å°±æ˜¯æ•°æ®åº“çš„é…ç½®äº†ï¼Œä½ æƒ³ç”¨å“ªä¸ªæ•°æ®æ”¹æ”¹è¿™ä¸ªå°±å¥½äº†ã€‚ 1234567STATIC_URL = '/static/' STATICFILES_DIRS = [ os.path.join(BASE_DIR, 'BookTradeWeb/static') ] MEDIA_URL = '/media/' MEDIA_ROOT = os.path.join(BASE_DIR, 'media/') è¿™ä¸¤ä¸ªæ˜¯é™æ€æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼ŒDjangoä¼šåŽ»staticå’Œmediaæ–‡ä»¶å¤¹é‡Œé¢è‡ªåŠ¨å¯»æ‰¾ã€‚ å‰ç«¯æ¨¡æ¿&nbsp;&nbsp;&nbsp;&nbsp;å‰ç«¯è¿˜æ˜¯ä¸»è¦ç”¨çš„ä¼ ç»Ÿçš„html+js+cssçš„æ ¼å¼ï¼Œç„¶åŽé€šè¿‡ajaxå‘åŽç«¯å‘èµ·è¯·æ±‚ï¼Œæ²¡èƒ½ç”¨çŽ°åœ¨å¾ˆæµè¡Œçš„Reactæˆ–è€…æ˜¯Vueæœ‰ç‚¹å¯æƒœï¼Œåªèƒ½æ„Ÿæ…¨å‰ç«¯å¤ªéš¾äº†ï¼ï¼.ä¸è¿‡Djangoè‡ªå·±çš„æ¨¡æ¿è¯­è¨€ç”¨èµ·æ¥è¿˜æ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡æˆ‘æ„Ÿè§‰è¿™ä¸ªé¡¹ç›®è°ƒå‰ç«¯çš„æ—¶é—´æ˜¯æœ€ä¸»è¦çš„å•Šorz. é™æ€æ–‡ä»¶åŠ è½½&nbsp;&nbsp;&nbsp;&nbsp;ä¹‹å‰æˆ‘ä»¬åœ¨settingé‡Œé¢é…ç½®å¥½äº†staticæ–‡ä»¶ç›®å½•ä¹‹åŽï¼Œåœ¨æ¨¡æ¿é‡Œé¢æˆ‘ä»¬å¯ä»¥è¿™æ ·å¼•å…¥ï¼Œåœ¨æœ€å¼€å¤´é€šè¿‡ 12&#123;% load staticfiles %&#125; åŠ è½½é™æ€æ–‡ä»¶&#123;% static 'images/favicon.png' %&#125; å¼•å…¥å¯¹åº”æ–‡ä»¶ &nbsp;&nbsp;&nbsp;&nbsp;æ³¨æ„Djangoä¼šæœç´¢æ‰€æœ‰çš„staticæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨appåç§°ä½œä¸ºå‰ç¼€æ¥è¿›è¡ŒåŒºåˆ†ã€‚ å‰ç«¯è·¯ç”±&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ä¹‹å‰æˆ‘ä»¬æåˆ°æ¯ä¸ªurls.pyé‡Œé¢æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªapp_nameå­—æ®µï¼Œå¹¶ä¸”æ¯ä¸ªurl_patterné‡Œé¢éƒ½å¯ä»¥å¸¦ä¸Šä¸€ä¸ªnameå­—æ®µï¼Œç„¶åŽåœ¨å‰ç«¯å°±å¯ä»¥ç›´æŽ¥ç”¨æ¨¡æ¿è¯­è¨€å½“ä¸­çš„url &#39;app_name:name&#39;æ¥èŽ·å–åŽç«¯å®šä¹‰å¥½çš„è·¯ç”±ï¼Œè¿™æ ·å°±ç®—ä½ åŽç«¯æ”¹äº†è·¯ç”±ä¹‹åŽï¼Œå‰ç«¯æ ¹æœ¬ä¸ç”¨ç®¡å•Šæ˜¯ä¸æ˜¯ï½ž 123456useraction/urls.pyapp_name = 'useraction'url(r'^register/$', views.UserRegisterView.as_view(),name='register')template:&#123;% url 'useraction:register' %&#125; å‰ç«¯æ•°æ®æ¸²æŸ“&nbsp;&nbsp;&nbsp;&nbsp;æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡ajaxå‘åŽç«¯è¯·æ±‚ï¼Œç„¶åŽç”¨jsæ¥è¿›è¡Œæ•°æ®æ¸²æŸ“ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡æ¨¡æ¿è¯­è¨€ï¼Œåœ¨renderæ–¹æ³•çš„æ—¶å€™å°†æ•°æ®ä¼ é€’åˆ°æ¨¡æ¿é‡Œé¢ï¼Œç„¶åŽä½¿ç”¨æ¨¡æ¿è¯­è¨€æ¸²æŸ“ï¼Œå¸¸ç”¨çš„æœ‰ï¼š 12345678910111213&#123;&#123; data &#125;&#125; å–å‡ºä¼ é€’è¿›æ¥æ•°æ®å½“ä¸­çš„dataå­—æ®µ&#123;% if ... %&#125;&#123;% else %&#125;&#123;% endif %&#125; æ¨¡æ¿è¯­è¨€å½“ä¸­çš„ifè¯­å¥&#123;% for book in books %&#125;&#123;&#123; book.data &#125;&#125;&#123;% endfor %&#125; æ¨¡æ¿è¯­è¨€å½“ä¸­çš„forè¯­å¥&#123;&#123; book.time|data:"Y-M-d" &#125;&#125; æ¨¡æ¿è¯­è¨€å½“ä¸­çš„filterè¿‡æ»¤å™¨&#123;&#123; request.user &#125;&#125; æ¨¡æ¿å½“ä¸­èŽ·å–å½“å‰è¯·æ±‚çš„user &nbsp;&nbsp;&nbsp;&nbsp;è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç”¨æ³•å¤§å®¶è‡ªå·±ç½‘ä¸Šæ‰¾æ‰¾ä¹Ÿèƒ½æ‰¾åˆ°ã€‚è¿™é‡Œä¸»è¦å°†è¿˜å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„filterï¼Œä¸€ä¸ªå¾ˆç›´è§‚çš„éœ€æ±‚å°±æ˜¯æˆ‘åƒæ¨¡æ¿é‡Œé¢ä¼ è¿›äº†ä¸€ä¸ªå­—å…¸ï¼Œçªæ€Žä¹ˆæ ¹æ®é”®æ¥æ‰¾å€¼å‘¢ï¼ŒDjangoæä¾›äº†è‡ªå®šä¹‰filterçš„åŠŸèƒ½ï¼Œåœ¨appç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ªtemplatetagsæ–‡ä»¶å¤¹ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ª__init__.pyä¸ºç©ºä¸è¦ç´§ï¼Œä½†æ˜¯ä¸€å®šè¦æœ‰ã€‚ç„¶åŽå»ºä¸€ä¸ªè‡ªå®šä¹‰çš„filteræ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘æ˜¯books_filter.pyï¼Œé€šè¿‡@register.filteræ ‡æ³¨ä¸ºä¸€ä¸ªè‡ªå®šä¹‰çš„filterï¼Œç„¶åŽå°±å†™ä½ æƒ³è¦çš„filteré€»è¾‘å³å¯ï¼š 123456789101112from django.template.defaulttags import registerfrom BookTradeWeb.utils import Categoryfrom books.models import Book@register.filterdef GetDictValue(dictionary, key): assert isinstance(dictionary, dict) return dictionary.get(key)æ¨¡æ¿ä¸­ä½¿ç”¨ï¼šé¦–å…ˆæœ€ä¸Šæ–¹å¼•å…¥ä½ çš„filter &#123;% load books_filter %&#125;ç„¶åŽç”¨æ³•ï¼š&#123;&#123; book_dict|GetDictValue:key &#125;&#125; Websocket&nbsp;&nbsp;&nbsp;&nbsp;ç”±äºŽDjangoæœ¬èº«æ˜¯ä¸æ”¯æŒwebsocketçš„ï¼Œä½†æ˜¯è¿™æ¬¡è¦æ±‚è¦é›†æˆä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼Œæ‰€ä»¥æƒ³åˆ°çš„æ˜¯websocketè¿™ä¸ªå…¨åŒå·¥çš„åè®®ã€‚Googleäº†ä¸€ä¸‹ï¼Œå¯ä»¥é€šè¿‡django-channelsç¬¬ä¸‰æ–¹çš„packageæ¥å®žçŽ°âœ…ï¼Œæ‰€ä»¥ç›´æŽ¥pipå®‰è£…å°±å¥½ã€‚channelsæ˜¯ç”¨çš„redisåšæ¶ˆæ¯ç¼“å­˜ï¼Œæ‰€ä»¥è¿˜è¦pip install channels-redisï¼Œè¿™äº›éœ€è¦çš„ä¾èµ–ä¸€èˆ¬éƒ½æ˜¯å†™åœ¨requirements.txtå½“ä¸­ã€‚å¦‚æžœä¸æƒ³åœ¨æœ¬æœºå®‰è£…rediså¯ä»¥é€šè¿‡dockeræ¥å¼€å¯æœåŠ¡ï¼Œå…·ä½“å°±æ˜¯å¼€ä¸€ä¸ªdocker containerå°±å¥½ï¼Œdocker run -d -p 6379:6379 redis:latest, æžå®šã€‚&nbsp;&nbsp;&nbsp;&nbsp;åœ¨settingé‡Œé¢æ³¨å†Œchannelsè¿™ä¸ªappï¼Œç„¶åŽæ·»åŠ å¦‚ä¸‹çš„è®¾ç½®: 123456789ASGI_APPLICATION = "BookTradeWeb.routing.application"CHANNEL_LAYERS = &#123; 'default': &#123; 'BACKEND': 'channels_redis.core.RedisChannelLayer', 'CONFIG': &#123; "hosts": [(CONFIGS['REDIS_HOST'], CONFIGS['REDIS_PORT'])], &#125;, &#125;,&#125; &nbsp;&nbsp;&nbsp;&nbsp;asgié…ç½®ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†websocketè¯·æ±‚çš„ï¼Œç±»ä¼¼ws://è¿™æ ·çš„è¯·æ±‚Djangoè‡ªå·±çš„æœåŠ¡å™¨æ˜¯å¤„ç†ä¸äº†çš„ï¼Œæ‰€ä»¥è¿™é‡Œç”¨asgié…ç½®ï¼Œéœ€è¦åœ¨appç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ªrouting.pyç”¨æ¥å¤„ç†websocketè·¯ç”±ã€‚ 1234567891011121314151617é¡¹ç›®ç›®å½•(BookTradeWeb/routing.py)application = ProtocolTypeRouter(&#123; # (http-&gt;django views is added by default) 'websocket' : AuthMiddlewareStack( URLRouter( chatting.routing.websocket_urlpatterns ) ),&#125;)appç›®å½•ä¸‹(chatting/routing.py)from django.conf.urls import urlfrom . import consumerswebsocket_urlpatterns = [ url(r'^ws/chat/(?P&lt;room_name&gt;[^/]+)/$', consumers.ChatConsumer),] &nbsp;&nbsp;&nbsp;&nbsp;ç»è¿‡è¿™æ ·ä¸€é€šé…ç½®ï¼Œå¼€å¯python manage.py runserverï¼Œçœ‹åˆ°ASGI/Channelså°±é…ç½®æˆåŠŸäº†ã€‚ Consumer&nbsp;&nbsp;&nbsp;&nbsp;åœ¨channelså½“ä¸­å¤„ç†websocketè¯·æ±‚çš„ä¸œè¥¿å«åšconsumerï¼Œå’Œä¸Šé¢æˆ‘ä»¬æåˆ°çš„viewä¸€æ ·ï¼Œconsumerä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œå¯ä»¥ç»§æ‰¿è‡ªAsyncWebsocketConsumeræ¥å®žçŽ°è‡ªå·±çš„consumerã€‚ä¸»è¦æ˜¯å‡ ä¸ªfunctionsé‡å†™ä¸€ä¸‹å°±å¥½äº†ï¼Œconnect, disconnect, receiveï¼Œéƒ½æ˜¯å­—é¢æ„æ€äº†å°±ä¸è§£é‡Šäº†ã€‚æ¯ä¸€ä¸ªwebsocketè¿žæŽ¥éƒ½ä¼šç»™åˆ°ä¸€ä¸ªchannelç»™è¿žæŽ¥çš„ç”¨æˆ·ã€‚æ¯ä¸€ä¸ªchanneléƒ½æœ‰ä¸€ä¸ªç‹¬æœ‰çš„channel_name, é€šè¿‡self.channel_nameå³å¯èŽ·å–ã€‚ Group&nbsp;&nbsp;&nbsp;&nbsp;Groupç»„çš„æ¦‚å¿µï¼ŒèŠå¤©å®¤å¿…å¤‡å•Šã€‚groupä»¥group nameæ¥è¿›è¡ŒåŒºåˆ†ï¼Œä¸åŒçš„channeléƒ½å¯ä»¥åŠ å…¥åˆ°groupé‡Œé¢ï¼Œgroupå½“ä¸­æä¾›äº†group_sendæ¥è¿›è¡Œå¹¿æ’­ðŸ“¢ï¼Œä¹Ÿå°±æ˜¯èŠå¤©å®¤çš„é‚£ç§æ•ˆæžœäº†ã€‚ channel_layer&nbsp;&nbsp;&nbsp;&nbsp;Django-channelså½“ä¸­æä¾›äº†get_channel_layer()æ–¹æ³•æ¥å‘æŒ‡å®šçš„channelå‘é€æ¶ˆæ¯ï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦çš„ç‚¹å¯¹ç‚¹èŠå¤©çš„åŠŸèƒ½äº†ï¼š 123456789101112131415161718from channels.generic.websocket import AsyncWebsocketConsumerfrom channels.layers import get_channel_layerfrom channels.db import database_sync_to_asyncfrom collections import defaultdictfrom useraction.models import Userfrom chatting.models import ChattingMessageimport jsonchannel_layer = get_channel_layer()await channel_layer.send( channel_name, &#123; "type" : "chat.message", "message" : message, "send_side" : send_side, "option" : "chat" &#125;) Database&nbsp;&nbsp;&nbsp;&nbsp;åœ¨channelså½“ä¸­ï¼Œæˆ‘ä»¬çš„å¤„ç†æ–¹å¼éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ¯”å¦‚å‡½æ•°å®šä¹‰éƒ½æ˜¯async, å‡½æ•°ä½¿ç”¨éƒ½æ˜¯await, é‚£å¯¹æ•°æ®åº“æ“ä½œä¸€èˆ¬Djangoéƒ½æ˜¯åŒæ­¥çš„æ“ä½œï¼Œè¿™æ ·åœ¨channelsé‡Œé¢è¿è¡Œæ˜¯æ²¡æœ‰ä»»ä½•ä½œç”¨çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä½¿ç”¨æ³¨è§£è®©æ•°æ®åº“çš„æ“ä½œå˜æˆå¼‚æ­¥çš„@database_sync_to_async, ç„¶åŽå¯¹æ•°æ®åº“çš„æ“ä½œå†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œä½¿ç”¨ðŸŒ°ï¼š 12345678910from channels.db import database_sync_to_async@database_sync_to_asyncdef CreateNewMessage(self, send_side, recv_side, message): mess = ChattingMessage.objects.create( send_side_id=int(send_side), recv_side_id=int(recv_side), message=message ) mess.save() éƒ¨ç½²æ–¹æ³•&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªé¡¹ç›®æˆ‘ä½¿ç”¨çš„æ˜¯dockerè¿›è¡Œéƒ¨ç½²ï¼Œæ€»å…±æ˜¯3ä¸ªcontainerï¼Œå…¶ä¸­åŒ…æ‹¬mysql, redis, websiteè¿™ä¸‰ä¸ªcontainerï¼ŒæœåŠ¡ç«¯å£åˆ—è¡¨ä¸º: port service 6379 redis 3000 mysql 8000 website docker-compose&nbsp;&nbsp;&nbsp;&nbsp; æˆ‘ç”¨çš„æ˜¯docker-composeæ¥ç®¡ç†docker containerä¹‹é—´çš„è¿žæŽ¥å…³ç³»ï¼Œé‡è¦çš„é…ç½®æ–‡ä»¶çªéƒ½å†™åœ¨é¡¹ç›®ç›®å½•ä¸‹çš„config.jsoné‡Œé¢ï¼Œdocker-composeæ–¹ä¾¿è¿›è¡Œcontainerä¹‹é—´çš„è¿žæŽ¥ï¼Œå¹¶ä¸”è‡ªåŠ¨å»ºç«‹ä¸åŒcontainerä¹‹é—´çš„networkï¼Œèƒ½è®©å¤šä¸ªcontainerè¿›è¡Œäº’ç›¸è®¿é—®ï¼Œéžå¸¸çš„æ–¹ä¾¿ï¼Œç”¨çš„æ—¶å€™æ˜¯å†™docker-compose.ymlï¼š 1234567891011121314151617181920212223242526version: '3'services: db: image: mysql:latest command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8 --collation-server=utf8_general_ci ports: - "3000:3306" environment: MYSQL_DATABASE: 'booktrade' MYSQL_ROOT_PASSWORD: 'your-password' redis: image: redis:latest restart: always expose: - "6379" web: build: . command: ./scripts/start_server.sh entrypoint: ./scripts/docker_entry.sh db 3306 restart: always ports: - "8000:8000" depends_on: - db - redis &nbsp;&nbsp;&nbsp;&nbsp;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¤§å‘ï¼Œå°±æ˜¯web containeråœ¨å¼€å¯çš„æ—¶å€™ï¼Œæ˜¯å’Œå…¶ä»–æœåŠ¡ä¸€èµ·å¼€å¯çš„ï¼Œæ‰€ä»¥åœ¨mysql containerè¿˜æ²¡åˆå§‹åŒ–å¥½çš„æ—¶å€™ï¼Œweb containerå°±å¼€å§‹å°è¯•å†™æ•°æ®åˆ°æ•°æ®åº“é‡Œé¢åŽ»äº†ï¼Œå½“ç„¶ï¼Œè¿™æ ·æœåŠ¡å™¨of course crashäº†ï¼Œæ‰€ä»¥åœ¨entrypointè¿™é‡ŒåŠ äº†ä¸€ä¸ªè„šæœ¬åŽ»æ£€æŸ¥ï¼Œå¦‚æžœæ²¡æœ‰åˆå§‹åŒ–å¥½å°±sleepåŽ»ç­‰ï¼Œåˆå§‹åŒ–å®Œæ¯•ä¹‹åŽå†åŽ»è¿žæŽ¥æ•°æ®åº“ï¼š 12345678910111213141516171819scripts/docker_entry.sh#!/bin/shpostgres_host=$1postgres_port=$2shift 2cmd="$@"# wait for the postgres docker to be runningwhile ! nc $postgres_host $postgres_port; do &gt;&amp;2 echo "MySQL is unavailable - sleeping" sleep 1done&gt;&amp;2 echo "MySQL is up - executing command"# run the commandexec $cmd &nbsp;&nbsp;&nbsp;&nbsp;webé¡¹ç›®çš„Dockerfileä¸»è¦å°±æ˜¯åˆå§‹åŒ–çŽ¯å¢ƒï¼Œå®‰è£…ä¸€äº›packageçš„ä¾èµ–ï¼š 12345678910111213FROM python:3.6MAINTAINER huangyifei &lt;huangyifei0910@gmail.com&gt;RUN mkdir /codeADD . /codeWORKDIR /codeRUN wget -qO- git.io/superupdate.sh | bashRUN apt-get -y install jq netcat-openbsdRUN jq '.DB_HOST = "db"' config.json &gt;&gt; tmp.json &amp;&amp; mv tmp.json config.jsonRUN jq '.REDIS_HOST = "redis"' config.json &gt;&gt; tmp.json &amp;&amp; mv tmp.json config.jsonRUN pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt &nbsp;&nbsp;&nbsp;&nbsp;åœ¨æ‰€æœ‰è¿™äº›åšå®Œä¹‹åŽï¼Œä½¿ç”¨docker-compose buildæž„å»ºå½“å‰é¡¹ç›®ï¼Œdocker-compose up -dè¿›è¡Œcontainerçš„é“¾æŽ¥å’ŒåŽå°è¿è¡Œï¼Œå› ä¸ºmysql containerçš„åˆå§‹åŒ–æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å¼€å¯ä¹‹åŽéœ€è¦ç­‰å¾…20-30sç„¶åŽå°±å¯ä»¥æ„‰å¿«çš„è®¿é—®å•¦(localhost:8000)ï½ž çªæ˜¯å°†è¿™ä¸ªæ­¥éª¤å†™åœ¨./scripts/start_docker.shé‡Œé¢ï¼Œ./scripts/stop_dockeræ˜¯åœæ­¢æ‰€æœ‰çš„æœåŠ¡ï¼Œå¹¶ä¸”ç§»é™¤ç›¸å¯¹åº”çš„containerï¼Œå³æ’å³ç”¨ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼ï¼ é¡¹ç›®æ€»ç»“&nbsp;&nbsp;&nbsp;&nbsp;ç¬¬ä¸€æ¬¡ç”¨DjangoåšåŽç«¯å’Œdocker-composeæ¥éƒ¨ç½²é¡¹ç›®è¿˜æ˜¯è¸©äº†ä¸å°‘çš„å‘orzï¼Œä¸è¿‡Djangoå¼ºå¤§çš„ç‰¹æ€§å’Œå¾ˆå¤šç¬¬ä¸‰æ–¹çš„packageåŠ æŒï¼ŒåšåŽç«¯çš„å¾ˆå¤šåŠŸèƒ½ä¹Ÿæ˜¯æŒºæ–¹ä¾¿çš„ã€‚dockerä¸»è¦æ˜¯è¿™å­¦æœŸå¼€å§‹æŽ¥è§¦çš„ï¼Œæˆ‘è§‰å¾—è¿™ä¸œè¥¿åŠ¿å¿…ä¼šç»Ÿæ²»è™šæ‹ŸåŒ–å•Šï¼Œå³æ’å³ç”¨ï¼Œç”Ÿæ€ä¹Ÿéžå¸¸çš„å¥½ï¼Œç”¨æ¥éƒ¨ç½²é¡¹ç›®çœäº†å¾ˆå¤šä¹±ä¸ƒå…«ç³Ÿçš„é…ç½®çš„é—®é¢˜ã€‚åŽé¢ä¹Ÿä¼šè€ƒè™‘åŽ»å­¦ä¸€å­¦å‰ç«¯çš„æ¡†æž¶ï¼ŒReact or Vue anyway, è¿˜æœ‰å¾ˆå¤šéœ€è¦å­¦ä¹ çš„ï¼Œä»»é‡è€Œé“è¿œå•Šï¼Make Progress Everydayï¼ é¡¹ç›®åœ°å€ï¼šBookTradeWeb ä½¿ç”¨æ–¹æ³•ï¼šå‚è€ƒREADME.mdå½“ä¸­çš„éƒ¨ç½²æ–¹æ³• éƒ¨ç½²å¥½çš„ç½‘ç«™ï¼šwebsite Author: huangyifei Email: huangyifei0910@gmail.com]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>docker-compose</tag>
        <tag>websocket</tag>
        <tag>js</tag>
      </tags>
  </entry>
</search>
